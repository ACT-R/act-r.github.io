<html>
  <head>

    <!-- META -->
    <title>ACT-R Lemonade Stand</title>
    <meta charset="UTF-8">
    <meta name="description" content="ACT-R Live Demo">
    <meta name="keywords" content="ACT-R, Cognitive Architecture, Lemonade Stand">
    <meta name="author" content="Derek Brown">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- UIKit Import -->
    <link rel="stylesheet" href="lib/uikit/dist/css/uikit.min.css" />
    <script src="lib/jquery/dist/jquery.min.js"></script>
    <script src="lib/uikit/dist/js/uikit.min.js"></script>
    <script src="lib/uikit/dist/js/uikit-icons.min.js"></script>

    <!-- Style Import -->
    <link rel="stylesheet" href="css/actr.css">
    <link rel="icon" sizes="16x16 32x32 48x48" href="img/favicon.ico">

    <!-- Web Font Import -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400" rel="stylesheet">

  </head>
  <body>

    <section id="header">
      <img src="img/header.png" />
      <h1> ACT-R Lemonade Stand </h1>

      <a class="github-button uk-button uk-button-primary uk-box-shadow-hover-medium uk-button-large" href="https://github.com/ACT-R" uk-icon="icon: github">
        GitHub
      </a><br>

      <a class="play-button uk-button uk-button-danger uk-box-shadow-hover-medium uk-button-large" href="http://actr-lemonade-stand.herokuapp.com" uk-icon="icon: play-circle">
        Play Now!
      </a>
      <p class="uk-article-meta">
        Note: our server runs on demand, so be patient.
      </p>



    </section>

    <section id="about" class="uk-article">
        <h1 class="uk-heading-divider">About</h1>

        <h2> What is ACT-R?</h2>
        <p>
          ACT-R is a <a href="https://en.wikipedia.org/wiki/Cognitive_architecture">
          cognitive architecture</a>, an extremely powerful
          computer model for developing and testing theories of cognitive
          behavior on a variety of tasks. Developed by
          researchers at <a href="http://act-r.psy.cmu.edu/about/">
          Carnegie Mellon University</a>, ACT-R is based on
          <a href="http://act-r.psy.cmu.edu/publication/">hundreds of
          psychological studies and papers</a>, and can provably
          emulate human performance in both task time and accuracy.

          Because of this, ACT-R is an incredible research and educational
          tool, allowing cognitive scientists to rapidly iterate on hypotheses
          of behavior.
        </p>

        <h2> What is ACT-R Lemonade Stand?</h2>
        <p>
          Because of the complexity of the ACT-R Architecture, it is difficult
          to explain to a non-user how ACT-R can be applied to
          psychological research.  Inspired by tools
          tools like <a href="https://scratch.mit.edu/">MIT's Scratch Project</a>,
          ACT-R Lemonade Stand provides a hands-on introduction to the concepts
          of ACT-R through visual programming.  It presents students with a
          simple example, the <a href="#game">
          Lemonade Stand Game</a>, and teaches them to develop
          a series of models capable of improved performance on the task.
        </p>
    </section>


    <section id="game" class="uk-article">
        <h1 class="uk-heading-divider">The Game</h1>

        <h2> How do you play Lemonade Stand?</h2>
        <p>
          The Lemonade Stand Game is a commonly-used teaching tool for
          elementary school mathematics.  There are many implementations of the
          game (<a href="http://www.freeonlinegames.com/tag/food-serve-games/sim-lemonade">SimLemonade</a>,
          for example, pictured in the screenshots below), but all tend to have a similar
          game cycle:
        </p>

        <div class="uk-child-width-1-2@s" uk-grid>
          <div>
            <div class="caption-box">
                <div class="img-wrapper" style="background-color:#fff">
                  <img src="img/lm_1.png"/>
                </div>
                <div class="text-wrapper">
                  <b> 1) Inventory View </b><br>
                  The user is shown a screen listing the quantity of lemonade
                  ingredients (Lemons, Sugar, Ice and Cups) in their inventory, as
                  well as their score (usually a dollar amount).

                  <br>
                  <br>
                  <a href="http://www.freeonlinegames.com/tag/food-serve-games/sim-lemonade">Source: SimLemonade</a>
                </div>
            </div>
          </div>
          <div>
            <div class="caption-box">
                <div class="img-wrapper" style="background-color:#fff">
                  <img src="img/lm_3.png"/>
                </div>
                <div class="text-wrapper">
                  <b> 2) Weather View </b><br>
                  The user is then shown a screen with a weather forecast, which
                  is predictive of the number of customers willing to buy
                  lemonade during that particular game cycle.

                  <br>
                  <br>
                  <a href="http://www.freeonlinegames.com/tag/food-serve-games/sim-lemonade">Source: SimLemonade</a>
                </div>
            </div>
          </div>
          <div>
            <div class="caption-box">
                <div class="img-wrapper" style="background-color:#fff">
                  <img src="img/lm_2.png"/>
                </div>
                <div class="text-wrapper">
                  <b> 3) Purchase Option </b><br>
                  The user is given the option to purchase each of the inventory
                  items (Lemons, Sugar, Ice and Cups) for a certain cost.  This
                  implementation has bulk options (not included in our version).

                  <br>
                  <br>
                  <a href="http://www.freeonlinegames.com/tag/food-serve-games/sim-lemonade">Source: SimLemonade</a>
                </div>
            </div>
          </div>
          <div>
            <div class="caption-box">
                <div class="img-wrapper" style="background-color:#fff">
                  <img src="img/lm_4.png"/>
                </div>
                <div class="text-wrapper">
                  <b> 4) End-Of-Day View </b><br>
                  Once the user has completed their turn, the day
                  begins.  The game simulates the number of cups of lemonade sold,
                  and the cycle repeats.

                  <br>
                  <br>
                  <a href="http://www.freeonlinegames.com/tag/food-serve-games/sim-lemonade">Source: SimLemonade</a>
                </div>
            </div>
          </div>
        </div>

      <h2> How does the Game Work?</h2>
      <p>
        The Lemonade Stand Game is a particularly good case study
        for teaching ACT-R because there are a number of models, increasing in
        complexity, which can be used to introduce students to the basic features
        of ACT-R.  To do this, a Javascript implementation of the game was implemented
        with the following game dynamics:
      </p>

      <div class="uk-child-width-1-2@s" uk-grid>
        <div style="font-size:14px;">
            <p>
              <b>Purchase Costs</b><br>
              The costs associated with each item are statically
              determined.  While this changes the slope of profit over
              time, it doesn't effect the optimal strategy.
            </p>

            <p>
              <b>Weather</b><br>
              The weather condition (Sunny, Cloudy, Rainy, Snowy)
              is determined via the output of a random
              Markov chain (pictured right). The game begins in the
              Sunny state, and transitions with probability
              1/3 in either direction (unless at the end of the chain).
              The temperature is determined from a given state based on a
              uniform distribuition specific to each condition.
            </p>
            <p>
              <b>Inventory Effects</b><br>
              The inventory spoils with a specified, independent probability
              for each day. Ice spoils every day, lemons spoil with probability
              (1/3), and sugar spoils with probability (1/4).
            </p>

            <p>
              <b>Cups Sold</b><br>
              Each cup of lemonade requires a number of inventory items,
              specified by a recipe. On a given day, the number of customers
              is determined by a weather condition-specific multiplier
              times the temperature (shown at right). Thus the cups sold is the
              minimum of the (inventory / recipe), and the number of customers.
            </p>
        </div>
        <div>
          <div class="caption-box" style="margin-top:100px;">
            <div class="img-wrapper" style="background-color:#fff">
              <img src="img/markov.png"/>
            </div>
            <div class="text-wrapper">
              Markov Model used to determine the number of cups sold.
            </div>
          </div>
        </div>
      </div>

      <h2> How do I win? </h2>
      <div class="uk-child-width-1-2@s" uk-grid>
        <div>
          <p>
            While it naively might seem like an optimal strategy to buy the maximum
            quantity of ingredients, the ingredients each have a probability of being
            lost- ice melts at the end of each day, and lemons and sugar spoil with
            some small probability. Thus, a good player must learn to purchase the
            items in the appropriate ratio, and in just the right quantity to
            “scrape by” for the day.
          </p>
          <p>
            The Lemonade Stand Game has an optimal strategy- that is, one could
            perform a series of calculations and determine the "correct" move
            at each stage in the game to maximize profit.  While someone might
            do this for running an actual small business, this is not typical
            of the way individuals play the game- instead, they estimate
            using their knowledge of previous results, a process which is called
            "Utility Learning" in ACT-R.  In the Lemonade Stand Game Tutorial,
            students will learn to build a model for both of these approaches.
          </p>
        </div>
        <div>
          <div class="caption-box">
            <div class="img-wrapper" style="background-color:#000">
              <img src="img/game.png" />
            </div>
            <div class="text-wrapper">
              Command-Line version of the Game.
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="interface" class="uk-article">
        <h1 class="uk-heading-divider">Interface</h1>
    </section>

    <section id="lessons" class="uk-article">
        <h1 class="uk-heading-divider">Lessons</h1>

        <div uk-grid>
          <div class="uk-width-auto@m">
            <ul class="uk-tab-left" uk-tab='connect: .lesson-switcher'>
                <li><a href="#">Unit 1</a></li>
                <li><a href="#">Unit 2</a></li>
                <li><a href="#">Unit 3</a></li>
                <li><a href="#">Unit 4</a></li>
            </ul>
          </div>
          <div class="uk-width-expand@m">
            <ul class="uk-switcher lesson-switcher">
                <li>
                  <h2> Fixed Strategy <span> | Unit 1 </span> </h2>
                </li>
                <li>
                  <h2> Visual Module <span> | Unit 2 </span> </h2>
                </li>
                <li>
                  <h2> Declarative Module <span> | Unit 3 </span> </h2>
                </li>
                <li>
                  <h2> Utility Learning <span> | Unit 4 </span> </h2>
                </li>
            </ul>
          </div>
        </div>
    </section>

    <section id="design" class="uk-article">
        <h1 class="uk-heading-divider">Architecture</h1>

        <div uk-grid>
          <div class="uk-width-auto@m">
            <ul class="uk-tab-left" uk-tab='connect: .design-switcher'>
                <li><a href="#">Overview</a></li>
                <li><a href="#">Game</a></li>
                <li><a href="#">Blocks</a></li>
                <li><a href="#">ACT-R</a></li>
                <li><a href="#">Deployment</a></li>
            </ul>
          </div>
          <div class="uk-width-expand@m">
            <ul class="uk-switcher design-switcher">

                <!-- OVERVIEW -->
                <li>
                  <h2> Design Overview </h2>

                  <p>
                    ACT-R Lemonade Stand is a relatively complex application,
                    as it requires constructing, then executing Lisp code
                    from within the browser.  In order to facilitate this,
                    it makes use of the <a href="https://www.meteor.com/">Meteor Framework</a>,
                    which combines NodeJS, MongoDB and the Blaze frontend in a single platform
                    for developing powerful Javascript applications.
                  </p>

                  <div class="caption-box">
                    <div class="img-wrapper" style="background-color:#FFF">
                      <img src="img/diagram.png" style="max-width:700px;" />
                    </div>
                  </div>

                  <p>
                    The above diagram provides an overview of the many modules which
                    work in synchrony to run ACT-R Lemonade Stand.  All of the code
                    is open source, and licensed under the <a href="https://github.com/ACT-R/Lemonade-Stand/blob/master/LICENSE">
                    GNU Public License v3</a>, available for download on our GitHub page:
                  </p>

                  <center>
                    <a class="github-button uk-button uk-button-primary uk-box-shadow-hover-medium uk-button-large" href="https://github.com/ACT-R" uk-icon="icon: github">
                      ACT-R Lemonade on GitHub
                    </a>
                  </center>

                </li>

                <!-- GAME -->
                <li>
                  <h2> Lemonade Stand Game </h2>

                  <p>
                    While many implementations of the Lemonade Stand Game exist,
                    the versions that are available are predominately Flash Games,
                    which don't have an external interface for controlling user
                    actions (which is needed to connect the game to ACT-R).  Thus,
                    a <a href="https://github.com/ACT-R/Lemonade-Stand/blob/master/server/game.js">
                    Javascript version</a> of the Lemonade Stand Game was developed
                    specifically for ACT-R Lemonade Stand.
                  </p>

                  <p>
                    The game was developed in an object-oriented fashion using
                    Javascript ES6, such that the main GameState class can be called
                    from both an ACT-R and Human interface.  The game stores previous
                    moves, so that accuracy and score differentials can be computed,
                    and has statically-defined constants so that game settings can
                    be tweaked easily in later versions, or to test that students
                    are actually using utility learning, as opposed to hardcoding
                    a strategy.
                  </p>

                  <p>
                    The human interface to the game was developed using the
                    <a href="https://github.com/sboudrias/Inquirer.js"> Inquirer</a>
                    library, a tool for creating command line applications in Node.JS.
                    A browser-based version of the game is currently under development.
                    The ACT-R interface is described in more detail in a later section.
                  </p>


                </li>

                <!-- BLOCKS -->
                <li>
                  <h2> Block Interface </h2>

                  <p>
                    The Visual Programming (Block) interface for the ACT-R
                    Lemonade Stand Game was developed using
                    <a href="https://developers.google.com/blockly/">Blockly</a>,
                    an open source library for creating a block-based UI. This library
                    was extended for the purposes of ACT-R in a number of ways:

                    <ul class="uk-list" style="font-size:14Spx; margin-left:30px; margin-bottom:20px;">
                      <li>
                        <b>Auto-Fill Button</b><br>
                        The default version of Blockly doesn't allow for the
                        creation of custom buttons on blocks, which was needed
                        for the "auto-fill" button used on the production-component
                        block.  In order to do this, a Forked version of Blockly
                        was created allowing for image fields to contain an
                        onclick method.  This feature is currently an
                        <a href="https://github.com/google/blockly/pull/1080">active
                        pull request</a> for the whole of the Blockly project.
                      </li>
                      <li>
                        <b>Default Blocks</b><br>
                        Some of the blocks (such as slots) are used in a number
                        of contexts because this allows for code reuse in the
                        generation phase (discussed below).  However, it isn't
                        necessarily clear to a user that these blocks are supposed
                        to be combined in such a way.  To make this more clear
                        certain blocks, when added to the workspace, are attached
                        to default blocks.
                      </li>
                      <li>
                        <b>ACT-R Generation</b><br>
                        Blockly contains code for auto-generating a number of
                        languages, such as Javascript and PHP, but not LISP
                        and most certainly not ACT-R.  Therefore, the bulk of the
                        code written for the Blockly interface dealt with defining
                        the shape, characteristics, and code generation associated
                        with each block.
                      </li>
                    </ul>
                  </p>
                  <p>
                    When the blocks in the workspace are modified, code is generated
                    according to the rules defined in Blockly.  The
                    generated code is piped into a read-only code editor, based on
                    the open source <a href="https://ace.c9.io/">Ace Editor</a>,
                    between specified <span style="font-size:12px">";;BEGIN-MODEL"</span>
                    and <span style="font-size:12px">";;END-MODEL"</span> tags, so
                    as to overwrite the model code without replacing the functions
                    needed to call the model.  Load functionality is
                    implemented by populating the blockly workspace
                    and the read-only editor from files (.xml and .lisp)
                    simultaneously, so as to replace
                    both the model and surrounding code.  Save functionality outputs
                    these two files to the user via the <a href="https://stuk.github.io/jszip/">jszip</a>
                    package.
                  </p>
                  <p>
                    Upon pressing the "run" button, the code inside the editor
                    is sent to the server via a <a href="https://guide.meteor.com/methods.html">Meteor Method</a>,
                    which triggers the execution of the ACT-R Interface backend.
                    As the model runs, the command line output, as well as results
                    are put into a session-specific temporary Mongo Database
                    subscribed to by the client.
                  </p>

                  <p>
                    The live console view (bottom right) is built using
                    a reactive <a href="https://www.meteor.com/blaze">Blaze</a>
                    template.  It places messages (sent on errors and success),
                    in the top of the console, while displaying error output
                    using CSS highlighting taken from the open source
                    <a href="https://github.com/sourcelair/xterm.js/">XTerm.js</a>
                    package.
                  </p>
                  <p>
                    The graph (upper right) subscribes to a Mongo Database specific
                    for raw data (stored as a JSON Object) sent by the client, and
                    is constructed reactively using the <a href="https://gionkunz.github.io/chartist-js/">
                    Chartist</a> library.
                  </p>
                </li>

                <!-- ACT-R -->
                <li>
                  <h2> ACT-R Interface </h2>

                  <p>
                    The most difficult development challenge of ACT-R Lemonade Stand
                    was to execute ACT-R Models, which are written in Lisp, from the browser.
                    To enable this, ACT-R Lemonade Stand downloads
                    <a href="https://ccl.clozure.com/">Clozure Common Lisp (CCL)</a>,
                    and the <a href="http://act-r.psy.cmu.edu/software/">ACT-R Library</a>
                    to the private folder upon installation.
                  </p>

                  <p>
                    When the browser is ready to execute a model, it is sent via a
                    <a href="https://guide.meteor.com/methods.html">Meteor Method</a>
                    to the server, where it is saved as a temporary file
                    using the <a href="https://www.npmjs.com/package/tmp">Tmp</a>
                    package, ensuring the file is deleted upon termination of the session.
                    The server then spawns a new CCL process wrapped with
                    the <a href="http://man7.org/linux/man-pages/man1/timeout.1.html">
                    Unix Timeout</a> command, which ensures that the process exits.
                  </p>
                  <p>
                    The output and input to the CCL process are piped through
                    <a href="https://github.com/nodejitsu/nexpect">NExpect</a>,
                    a NodeJS implementation of the Perl <a href="http://search.cpan.org/~rgiersig/Expect-1.21/Expect.pod">expect</a> library.
                    Nexpect passes the ACT-R library and the user's model as arguments to the CCL
                    process, and handles any unexpected output to the user via the
                    live console.  Otherwise, it executes the game loop by
                    executing the run-game command in the CCL
                    process, and parsing the output so that it can be passed back into
                    the game interface.  At each step, the relevant output is
                    published to the session database so that it is immediately
                    viewable by the user.
                  </p>
                  <p>
                    Nexpect was designed only to handle commands generated at compile-time,
                    where ACT-R Lemonade Stand's usecase required commands be generated
                    dynamically (to handle input from game states).  Nexpect was therefore
                    extended to include this functionality, which is the subject of two
                    active <a href="https://github.com/nodejitsu/nexpect/pulls">pull requests</a>.
                  </p>

                </li>

                <!-- DEPLOYMENT -->
                <li>
                  <h2> Deployment </h2>

                  <p>
                    ACT-R Lemonade Stand is extremely easy to install and setup,
                    Simply follow the steps below:

                    <ol class="install-steps">
                      <li>
                        <b>Install Meteor</b><br>
                        Meteor is a server development stack containing NodeJS,
                        MongoDB, and the Blaze frontend
                        and is available for Linux and MacOS:
                        <a href="https://www.meteor.com/install">Download here</a>
                        or via your package manager.

                      </li>
                      <li>
                        <b>Install Bower</b><br>
                        Bower is a static dependency managment tool.  After
                        installing Meteor, it can be installed with "meteor npm install -g bower".
                        Additional instructions on <a href="https://bower.io/">Bower's website</a>.

                      </li>
                      <li>
                        <b>Clone the ACT-R Lemonade Stand Repo</b><br>
                        Download
                        <a href="https://github.com/ACT-R/Lemonade-Stand">our repository</a>
                        into a local directory.

                      </li>

                      <li>
                        <b>Install</b><br>
                        Run "meteor npm install" in the application directory
                         to download the neccessary dependencies
                        and setup the application environment.  Report any errors
                        during installation to our <a href="https://github.com/ACT-R/Lemonade-Stand/issues"> issues page</a>.
                      </li>

                      <li>
                        <b>Launch</b><br>
                        ACT-R Lemonade Stand can be launched for local testing
                        and development by running "meteor" in the application
                        directory.
                        <br>
                        <br>
                        For production deployments, one should read the
                        <a href="https://guide.meteor.com/deployment.html">Meteor Deployment Guide</a>,
                        as the "meteor" command is not suited for production deployments.  Rather,
                        Meteor compiles the application to a regular Node.JS Application,
                        which can be run using <a href="https://github.com/foreverjs/forever">Forever</a>.
                      </li>
                    </ol>
                  </p>

                  <p>
                    ACT-R Lemonade Stand is actively hosted on
                    <a href="http://heroku.com">Heroku Cloud</a>,
                    and is automatically rebuilt by pushes to the Master branch
                    of the <a href="https://github.com/ACT-R/Lemonade-Stand">GitHub Repository</a>.
                    It makes use of the <a href="https://github.com/AdmitHub/meteor-buildpack-horse"> Meteor Buildpack</a>,
                    for automated compilation and deployment.
                  </p>

                </li>
            </ul>
          </div>
        </div>
    </section>

    <!-- FOOTER -->
    <section id="footer" style="font-size:14px; ">
      <h1 class="uk-heading-divider">Citations</h1>

      <div class="uk-child-width-1-3@s" uk-grid>
        <div>
          <b> ACT-R Lemonade Stand </b></br>
          Developed by <a href="http://derektbrown.com">Derek Brown</a>, an undergraduate
          student at Carnegie Mellon University as part of John Anderson's
          course, <a href="https://www.andrew.cmu.edu/course/85-412/">85-412 Cognitive Modelling</a>.
        </div>
        <div>
          <b> ACT-R </b></br>
          Developed by John Anderson, Dan Bothell, Christian Lebiere and
          other members of the <a href="http://act-r.psy.cmu.edu/">ACT-R Community</a>.
          It is distributed under the <a href="https://www.gnu.org/copyleft/lesser.html">LGPL License</a>.
        </div>
        <div>
          <b> Images </b></br>
          The Lemonade Stand Logomark is based on designs copied under a
          Creative Commons License obtained from the Noun Project:

          <ul class="uk-list" style="margin-left:30px;">
              <li><a href="https://thenounproject.com/term/lemon-pitcher/805906/">"Pitcher" by Royyan Wijaya</a></li>
              <li><a href="https://thenounproject.com/term/brain/844674/">"Brain" by Arthur Shlain</a></li>
              <li><a href="https://thenounproject.com/term/blocks/735188/">"Blocks" by Oliviu Stoiantaken</a></li>
          </ul>
        </div>
      </div>
    </section>


  </body>
</head>
